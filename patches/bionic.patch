From 854dfe6a6bc14dfeb017d8d3461ac74b17bd1004 Mon Sep 17 00:00:00 2001
From: ghsr <ghsr92@yandex.ru>
Date: Tue, 29 Mar 2016 21:59:35 +0600
Subject: [PATCH] libc: fix slow performance for some devices

Thanks to Dees-Troy

Change-Id: Id8334a2ec062a7aa8d7a8b07179f3b10fd14cfc8
---
 libc/bionic/libc_init_common.cpp | 15 ---------------
 1 file changed, 15 deletions(-)

diff --git a/libc/bionic/libc_init_common.cpp b/libc/bionic/libc_init_common.cpp
index bd71628..67c5e03 100644
--- a/libc/bionic/libc_init_common.cpp
+++ b/libc/bionic/libc_init_common.cpp
@@ -291,19 +291,6 @@ static void __sanitize_environment_variables(char** env) {
   dst[0] = nullptr;
 }
 
-static void __initialize_personality() {
-#if !defined(__LP64__)
-  int old_value = personality(0xffffffff);
-  if (old_value == -1) {
-    __libc_fatal("error getting old personality value: %s", strerror(errno));
-  }
-
-  if (personality((static_cast<unsigned int>(old_value) & ~PER_MASK) | PER_LINUX32) == -1) {
-    __libc_fatal("error setting PER_LINUX32 personality: %s", strerror(errno));
-  }
-#endif
-}
-
 void __libc_init_AT_SECURE(KernelArgumentBlock& args) {
   __libc_auxv = args.auxv;
 
@@ -327,8 +314,6 @@ void __libc_init_AT_SECURE(KernelArgumentBlock& args) {
 
   // Now the environment has been sanitized, make it available.
   environ = args.envp;
-
-  __initialize_personality();
 }
 
 /* This function will be called during normal program termination
-- 
2.8.1

