From ca08a0c225be138cd3e17714bd46306b15e1b391 Mon Sep 17 00:00:00 2001
From: andixlm <andixev@gmail.com>
Date: Sun, 26 Oct 2014 22:52:56 +0600
Subject: [PATCH] OMXCodec: Set default input buffer size for S2Plus

Change-Id: I2e0c396ac9c6102c583d33d845d2247fd4ea6597
---
 media/libstagefright/OMXCodec.cpp | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/media/libstagefright/OMXCodec.cpp b/media/libstagefright/OMXCodec.cpp
index f21a778..c6d4468 100644
--- a/media/libstagefright/OMXCodec.cpp
+++ b/media/libstagefright/OMXCodec.cpp
@@ -956,6 +956,19 @@ status_t OMXCodec::configureCodec(const sp<MetaData> &meta) {
         setMinBufferSize(kPortIndexInput, (OMX_U32)maxInputSize);
     }
 
+// CAPRI's OMX fail to set a reasonable default size from width and height
+#ifdef CAPRI_HWC
+    else if (!strncmp(mComponentName, "OMX.BRCM.vc4.decoder.", 21)) {
+        int32_t width;
+        int32_t height;
+        if (meta->findInt32(kKeyWidth, &width) && meta->findInt32(kKeyHeight, &height)) {
+            setMinBufferSize(kPortIndexInput, (width * height * 3) / 2);
+        } else {
+            ALOGE("Failed to set min buffer size");
+        }
+    }
+#endif
+
     initOutputFormat(meta);
 
     if ((mFlags & kClientNeedsFramebuffer)
-- 
1.9.1

